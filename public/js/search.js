const button = document.getElementById("go");

let data = { "meta": { "status": 200 }, "data": [{ "slug": "子供", "is_common": true, "tags": ["wanikani24"], "jlpt": ["jlpt-n5"], "japanese": [{ "word": "子供", "reading": "こども" }, { "word": "子ども", "reading": "こども" }, { "word": "小供", "reading": "こども" }], "senses": [{ "english_definitions": ["child"], "parts_of_speech": ["Noun"], "links": [], "tags": [], "restrictions": [], "see_also": [], "antonyms": [], "source": [], "info": [] }, { "english_definitions": ["Child"], "parts_of_speech": ["Wikipedia definition"], "links": [{ "text": "Read “Child” on English Wikipedia", "url": "http://en.wikipedia.org/wiki/Child?oldid=494816312" }, { "text": "Read “子供” on Japanese Wikipedia", "url": "http://ja.wikipedia.org/wiki/子供?oldid=42765047" }], "tags": [], "restrictions": [], "see_also": [], "antonyms": [], "source": [], "info": [], "sentences": [] }], "attribution": { "jmdict": true, "jmnedict": false, "dbpedia": "http://dbpedia.org/resource/Child" } }, { "slug": "小人", "is_common": true, "tags": [], "jlpt": [], "japanese": [{ "word": "小人", "reading": "しょうにん" }, { "word": "小人", "reading": "こびと" }, { "word": "小人", "reading": "しょうじん" }, { "word": "小人", "reading": "こども" }], "senses": [{ "english_definitions": ["child", "small person"], "parts_of_speech": ["Noun"], "links": [], "tags": [], "restrictions": [], "see_also": [], "antonyms": ["大人 おとな"], "source": [], "info": [] }, { "english_definitions": ["dwarf", "midget"], "parts_of_speech": ["Noun"], "links": [], "tags": [], "restrictions": ["こびと"], "see_also": [], "antonyms": ["巨人"], "source": [], "info": [] }, { "english_definitions": ["narrow-minded person", "mean person"], "parts_of_speech": ["Noun"], "links": [], "tags": [], "restrictions": ["しょうじん"], "see_also": [], "antonyms": ["君子"], "source": [], "info": [] }], "attribution": { "jmdict": true, "jmnedict": false, "dbpedia": false } }, { "slug": "子供達", "is_common": true, "tags": [], "jlpt": [], "japanese": [{ "word": "子供たち", "reading": "こどもたち" }, { "word": "子どもたち", "reading": "こどもたち" }, { "word": "子供達", "reading": "こどもたち" }, { "word": "子ども達", "reading": "こどもたち" }], "senses": [{ "english_definitions": ["children"], "parts_of_speech": ["Noun"], "links": [], "tags": [], "restrictions": [], "see_also": [], "antonyms": [], "source": [], "info": [] }], "attribution": { "jmdict": true, "jmnedict": false, "dbpedia": false } }, { "slug": "子供用", "is_common": true, "tags": [], "jlpt": [], "japanese": [{ "word": "子供用", "reading": "こどもよう" }], "senses": [{ "english_definitions": ["for use by children", "for children"], "parts_of_speech": ["Noun which may take the genitive case particle 'no'"], "links": [], "tags": [], "restrictions": [], "see_also": [], "antonyms": [], "source": [], "info": [] }], "attribution": { "jmdict": true, "jmnedict": false, "dbpedia": false } }, { "slug": "子供の頃", "is_common": true, "tags": [], "jlpt": [], "japanese": [{ "word": "子供の頃", "reading": "こどものころ" }, { "word": "子供のころ", "reading": "こどものころ" }, { "word": "子どもの頃", "reading": "こどものころ" }, { "word": "子どものころ", "reading": "こどものころ" }], "senses": [{ "english_definitions": ["(time of) one's childhood", "when one was a child"], "parts_of_speech": ["Expressions (phrases, clauses, etc.)", "Noun", "Adverb (fukushi)"], "links": [], "tags": [], "restrictions": [], "see_also": [], "antonyms": [], "source": [], "info": [] }], "attribution": { "jmdict": true, "jmnedict": false, "dbpedia": false } }, { "slug": "子供部屋", "is_common": false, "tags": [], "jlpt": [], "japanese": [{ "word": "子ども部屋", "reading": "こどもべや" }, { "word": "子供部屋", "reading": "こどもべや" }, { "word": "こども部屋", "reading": "こどもべや" }], "senses": [{ "english_definitions": ["child's room", "nursery"], "parts_of_speech": ["Noun"], "links": [], "tags": [], "restrictions": [], "see_also": [], "antonyms": [], "source": [], "info": [] }, { "english_definitions": ["Nursery (room)"], "parts_of_speech": ["Wikipedia definition"], "links": [{ "text": "Read “Nursery (room)” on English Wikipedia", "url": "http://en.wikipedia.org/wiki/Nursery_(room)?oldid=483119123" }, { "text": "Read “子供部屋” on Japanese Wikipedia", "url": "http://ja.wikipedia.org/wiki/子供部屋?oldid=39777706" }], "tags": [], "restrictions": [], "see_also": [], "antonyms": [], "source": [], "info": [], "sentences": [] }], "attribution": { "jmdict": true, "jmnedict": false, "dbpedia": "http://dbpedia.org/resource/Nursery_(room)" } }, { "slug": "子供扱い", "is_common": false, "tags": [], "jlpt": [], "japanese": [{ "word": "子供扱い", "reading": "こどもあつかい" }], "senses": [{ "english_definitions": ["treating someone like a child"], "parts_of_speech": ["Noun", "Suru verb"], "links": [], "tags": [], "restrictions": [], "see_also": [], "antonyms": [], "source": [], "info": [] }], "attribution": { "jmdict": true, "jmnedict": false, "dbpedia": false } }, { "slug": "子供じみた", "is_common": false, "tags": [], "jlpt": [], "japanese": [{ "word": "子供じみた", "reading": "こどもじみた" }, { "word": "子どもじみた", "reading": "こどもじみた" }, { "word": "子供染みた", "reading": "こどもじみた" }], "senses": [{ "english_definitions": ["childish", "childlike", "immature", "infantile"], "parts_of_speech": ["Noun or verb acting prenominally"], "links": [], "tags": [], "restrictions": [], "see_also": [], "antonyms": [], "source": [], "info": [] }], "attribution": { "jmdict": true, "jmnedict": false, "dbpedia": false } }, { "slug": "子供の使い", "is_common": false, "tags": [], "jlpt": [], "japanese": [{ "word": "子供の使い", "reading": "こどものつかい" }], "senses": [{ "english_definitions": ["useless messenger", "doing only as one is told", "fool's errand"], "parts_of_speech": ["Expressions (phrases, clauses, etc.)", "Noun"], "links": [], "tags": ["Idiomatic expression"], "restrictions": [], "see_also": [], "antonyms": [], "source": [], "info": [] }], "attribution": { "jmdict": true, "jmnedict": false, "dbpedia": false } }, { "slug": "子供心", "is_common": false, "tags": [], "jlpt": [], "japanese": [{ "word": "子供心", "reading": "こどもごころ" }, { "word": "子ども心", "reading": "こどもごころ" }], "senses": [{ "english_definitions": ["childlike mind", "judgment as a child (judgement)"], "parts_of_speech": ["Noun"], "links": [], "tags": [], "restrictions": [], "see_also": [], "antonyms": [], "source": [], "info": [] }], "attribution": { "jmdict": true, "jmnedict": false, "dbpedia": false } }] };
let mydata = [];
for (let i of data.data) {
    let wordList = [];
    for (let j of i.japanese) {
        wordList.push({ "kanji": j.word, "reading": j.reading });
    }
    let english = [];
    for (let k of i.senses) { english.push(k.english_definitions); }
    mydata.push({ wordList, english });
};
console.log(mydata);

button.addEventListener('click', () => {

    // Use another API. This one doesnt support CORS
    // let url = 'https://jisho.org/api/v1/search/words?keyword=';
    // let queryString = document.getElementById('queryString').value;

    // fetch(url + queryString)
    //     .then((response) => console.log(response.json()))
    //     .then((data) => console.log(data));
    let def = document.getElementById('definitions');

    if (!(def)) {
        def = document.createElement('div');
        def.setAttribute('id', 'definitions')
    }

    document.getElementById('main').appendChild(def);
    let index = 0;
    for (let i of mydata) {

        const newUnit = document.createElement('div');
        newUnit.classList.add("Unit");
        const newDef = document.createElement('div');
        newDef.classList.add("wordunit");
        def.appendChild(newUnit);
        newUnit.appendChild(newDef);
        const pre = document.createElement('pre');
        newDef.appendChild(pre);
        const plus = document.createElement('div');
        newUnit.appendChild(plus);

        plus.classList.add("plus");
        plus.setAttribute("data-i", index++);
        def.appendChild(document.createElement('hr'));

        plus.innerHTML = '+';
        // plus.innerHTML = '<a href="/add"> + </a>';

        i.wordList.forEach(x => {
            if (pre.innerText)
                pre.innerHTML += ", "
            pre.innerText += x.kanji;
            pre.innerText += ` (${x.reading})`;
        });

        pre.innerText += "\n";

        i.english.forEach(x => {
            if (pre.innerText.endsWith("\n"))
                pre.innerText += "* ";
            else
                pre.innerText += ", "
            pre.innerText += x.join(", ");
            pre.innerText += "\n";
        });

    }

    document.querySelectorAll('.plus').forEach(x => {
        x.addEventListener('click', function () {
            console.log(mydata[parseInt(this.dataset.i)]);
            localStorage.setItem('word', JSON.stringify(mydata[parseInt(this.dataset.i)]));
            window.location.replace("/add");
        });
    });

})
